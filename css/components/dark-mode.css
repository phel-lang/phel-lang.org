@media (prefers-color-scheme: dark) {
  :root {
    --color-bg: var(--color-dark-bg);
    --color-text-primary: var(--color-dark-text-primary);
    --color-text-secondary: var(--color-dark-text-secondary);
    --color-border: var(--color-dark-border);
  }
}

/* Dark mode class-based styling */
.dark {
  --color-bg: var(--color-dark-bg);
  --color-text-primary: var(--color-dark-text-primary);
  --color-text-secondary: var(--color-dark-text-secondary);
  --color-border: var(--color-dark-border);
  background-color: var(--color-dark-bg);
}

/* Body and root elements */
.dark body {
  background-color: var(--color-dark-bg);
  color: var(--color-dark-text-primary);
}

.dark html,
.dark :root {
  background-color: var(--color-dark-bg);
}

.dark .layout-container {
  background-color: var(--color-dark-bg);
}

/* Modern Dark Header with glassmorphism */
.dark .site-header {
  background: #0a0a0a;
  backdrop-filter: blur(var(--backdrop-blur-header)) saturate(180%);
  -webkit-backdrop-filter: blur(var(--backdrop-blur-header)) saturate(180%);
  border-bottom-color: rgba(51, 65, 85, 0.3);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3),
              0 2px 4px -1px rgba(0, 0, 0, 0.2);
}

.dark .site-header.scrolled {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

/* Dark logo styling */
.dark .site-header__logo .phel-logo {
  stroke: var(--color-dark-text-primary);
  filter: drop-shadow(0 2px 4px rgba(241, 245, 249, 0.1));
}

.dark .site-header__logo .logo-text {
  color: var(--color-dark-text-primary);
}


/* Dark navigation */
.dark .site-header__navigation a {
  color: var(--color-dark-text-secondary);
}

.dark .site-header__navigation a::after {
  background: var(--color-light-text-accent);
}

.dark .site-header__navigation a:hover {
  color: var(--color-light-text-accent);
}

.dark .site-header__navigation a[aria-current='page'],
.dark .site-header__navigation a.active {
  color: var(--color-light-text-accent);
}

/* Mobile hamburger icon dark mode */
.dark .site-header__mobile-menu .hamburger-icon span {
  background: var(--color-dark-text-primary);
}

.dark .site-header__mobile-menu .hamburger-icon:hover {
  background: rgba(99, 102, 241, 0.15);
}

/* Mobile navigation overlay dark */
@media (max-width: 1039px) {
  .dark .mobile-menu-overlay {
    background: #0a0a0a;
    backdrop-filter: blur(var(--backdrop-blur-lg));
    -webkit-backdrop-filter: blur(var(--backdrop-blur-lg));
  }

  .dark .mobile-menu-nav a {
    background: var(--color-dark-surface);
    border-color: var(--color-dark-border);
    color: var(--color-dark-text-primary);
  }

  .dark .mobile-menu-nav a:hover,
  .dark .mobile-menu-nav a:active {
    background: var(--color-light-text-accent);
    border-color: var(--color-light-text-accent);
    color: var(--color-dark-bg);
  }

  .dark .mobile-menu-link {
    background: var(--color-dark-surface);
    border-color: var(--color-dark-border);
    color: var(--color-dark-text-primary);
  }

  .dark .mobile-menu-link:hover,
  .dark .mobile-menu-link:active {
    background: var(--color-light-text-accent);
    border-color: var(--color-light-text-accent);
    color: var(--color-dark-bg);
  }

  .dark .mobile-menu-actions {
    border-top-color: var(--color-dark-border);
  }

  .dark .mobile-dark-mode-toggle {
    background: var(--color-dark-surface);
    border-color: var(--color-dark-border);
    color: var(--color-dark-text-primary);
  }

  .dark .mobile-dark-mode-toggle:hover {
    background: rgba(56, 189, 248, 0.15);
    border-color: var(--color-light-text-accent);
  }

  .dark .mobile-menu-toggle span {
    background: var(--color-dark-text-primary);
  }

  .dark .mobile-menu-toggle:hover {
    background: rgba(56, 189, 248, 0.15);
  }
}

/* Dark search input with modern styling */
.dark #search {
  background-color: var(--color-dark-bg-secondary);
  color: var(--color-dark-text-primary);
  border-color: #3a3a3a;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23666666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
}

.dark #search:hover {
  border-color: #4a4a4a;
  box-shadow: var(--shadow-dark-sm);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23888888' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
}

.dark #search:focus {
  border-color: #5a5a5a;
  background-color: var(--color-dark-surface);
  box-shadow: 0 0 0 3px rgba(90, 90, 90, 0.3),
              var(--shadow-dark-sm);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23999999' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
}

.dark #search::placeholder {
  color: var(--color-dark-text-muted);
}

/* Dark mode clear button */
.dark #search::-webkit-search-cancel-button {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23999999' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='15' y1='9' x2='9' y2='15'%3E%3C/line%3E%3Cline x1='9' y1='9' x2='15' y2='15'%3E%3C/line%3E%3C/svg%3E");
  opacity: 0.8;
}

.dark #search::-webkit-search-cancel-button:hover {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23cccccc' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cline x1='15' y1='9' x2='9' y2='15'%3E%3C/line%3E%3Cline x1='9' y1='9' x2='15' y2='15'%3E%3C/line%3E%3C/svg%3E");
  opacity: 1;
}

/* Dark search results scrollbar */
.dark .search-results::-webkit-scrollbar-thumb {
  background: var(--color-dark-border);
}

.dark .search-results::-webkit-scrollbar-thumb:hover {
  background: var(--color-dark-border-subtle);
}

/* Dark action buttons */
.dark .site-header__actions {
  color: var(--color-dark-text-primary);
}

.dark .site-header__link,
.dark .dark-mode-toggle {
  color: var(--color-dark-text-secondary);
}

.dark .site-header__link:hover,
.dark .dark-mode-toggle:hover {
  color: var(--color-light-text-accent);
  background: rgba(56, 189, 248, 0.15);
}

/* Dark typography */
.dark h1,
.dark h2,
.dark h3,
.dark h4,
.dark h5,
.dark h6 {
  color: var(--color-dark-text-primary);
}

.dark p {
  color: var(--color-dark-text-secondary);
}

.dark a {
  color: var(--color-light-text-accent);
}

.dark a:hover {
  color: var(--color-light-text-accent);
}

.dark a:not([class])::after {
  background: var(--color-light-text-accent);
}

/* Dark lists */
.dark ul li::before {
  background: var(--color-light-text-accent);
}

.dark ol li:before {
  color: var(--color-light-text-accent);
}

/* Dark images - no animations */
.dark img {
  opacity: 1;
}

/* Make homepage logo white in dark mode */
.dark img[src*="logo_phel.svg"] {
  filter: brightness(0) invert(1);
}

/* Dark blockquote */
.dark blockquote {
  background: var(--color-dark-blockquote-bg);
  border-left-color: var(--color-dark-blockquote-border);
  color: var(--color-dark-text-secondary);
  box-shadow: var(--shadow-dark-sm);
}

.dark blockquote::before {
  color: var(--color-dark-blockquote-border);
}

/* Dark code blocks */
.dark pre {
  background: var(--color-dark-code-bg);
  border-color: var(--color-dark-border);
  box-shadow: var(--shadow-dark-sm);
}

.dark pre::-webkit-scrollbar-thumb {
  background: var(--color-dark-border);
}

.dark pre::-webkit-scrollbar-thumb:hover {
  background: var(--color-gray-base);
}

/* Dark inline code */
.dark p code,
.dark li code {
  background-color: var(--color-dark-code-inline-bg);
  color: var(--color-light-text-accent);
  border-color: var(--color-dark-border);
}

/* Dark tables */
.dark table {
  box-shadow: var(--shadow-dark-sm);
}

.dark th {
  background: var(--color-dark-bg-secondary);
  color: var(--color-dark-text-primary);
  border-bottom-color: var(--color-light-text-accent);
}

.dark td {
  border-bottom-color: var(--color-dark-border);
}

.dark tr:hover {
  background: var(--color-dark-surface-hover);
}

/* Dark HR */
.dark hr {
  background: linear-gradient(
    90deg,
    transparent,
    var(--color-dark-border) 20%,
    var(--color-dark-border) 80%,
    transparent
  );
}

/* Dark separator */
.dark .separator {
  border-color: var(--color-dark-border);
}

/* Dark layout components */
.dark .one-column-layout,
.dark .two-column-layout {
  background: transparent;
}

@media (min-width: 1040px) {
  .dark .two-column-layout__sidebar {
    background: var(--color-dark-surface);
    border-color: var(--color-dark-border);
    box-shadow: var(--shadow-dark-sm);
  }
}

@media (max-width: 1039px) {
  .dark .two-column-layout__sidebar {
    background: transparent;
    border-bottom-color: var(--color-dark-border);
  }
}

/* Dark mode for sidebar toggle */
.dark .sidebar-toggle {
  background: var(--color-dark-bg-secondary);
  border-color: var(--color-dark-border);
  color: var(--color-dark-text-primary);
}

.dark .sidebar-toggle:hover {
  background: var(--color-dark-surface-hover);
  border-color: var(--color-light-link);
}

/* Dark mode for sidebar accordion open state */
.dark .two-column-layout__sidebar:has(.sidebar-content.active) {
  border-bottom-color: var(--color-dark-border);
}

.dark .two-column-layout__sidebar::-webkit-scrollbar-thumb {
  background: var(--color-dark-border);
}

/* Dark TOC */
.dark .page-toc {
  border-bottom-color: var(--color-dark-border);
}

.dark .page-toc h2 {
  color: var(--color-dark-text-primary);
}

/* Dark site navigation title */
.dark .site-navigation-title {
  color: var(--color-dark-text-primary);
}

/* Dark mode anchor links */
.dark .zola-anchor,
.dark .zola-anchor:hover {
  color: var(--color-dark-anchor);
}

/* Dark mode solution toggle */
.dark .solution label {
  background: var(--color-light-text-accent);
  color: var(--color-dark-bg);
}

.dark .solution label:hover {
  background: var(--color-light-link);
}

.dark .solution input[type="checkbox"]:checked ~ label {
  background: var(--color-light-link);
}

/* Dark mode navigation */
.dark .site-navigation__entry a:hover {
  background: var(--color-dark-surface-hover);
  color: var(--color-light-text-accent);
}

.dark .site-navigation__entry.active a {
  color: #b0ceff;
  background: var(--color-dark-surface-hover);
}

/* Dark mode blog styling */
.dark .post-list li a {
  border-bottom-color: var(--color-dark-border);
}

.dark .post-list li a h2 {
  color: var(--color-dark-text-primary);
}

.dark .post-list li a:hover h2 {
  color: var(--color-light-text-accent);
}

.dark .post-list li a .meta {
  color: var(--color-dark-text-muted);
}

.dark .post-list li a .excerpt {
  color: var(--color-dark-text-secondary);
}

/* Dark mode blog pagination */
.dark .pagination a {
  background: var(--color-dark-surface);
  border-color: var(--color-dark-border);
  color: var(--color-dark-text-primary);
}

.dark .pagination a:hover {
  background: var(--color-dark-surface-hover);
  border-color: var(--color-light-text-accent);
  color: var(--color-light-text-accent);
}

.dark .pagination a.active {
  background: var(--color-light-text-accent);
  color: var(--color-dark-bg);
  border-color: var(--color-light-text-accent);
}

/* Dark mode blog tags */
.dark .blog-tag {
  background: var(--color-dark-surface);
  border-color: var(--color-dark-border);
  color: var(--color-dark-text-secondary);
}

.dark .blog-tag:hover {
  background: var(--color-dark-surface-hover);
  border-color: var(--color-light-text-accent);
  color: var(--color-light-text-accent);
}

/* Dark API Index Pills */
.dark .api-namespace-toggle {
  border-bottom-color: var(--color-dark-border);
}

.dark .api-namespace-title {
  color: var(--color-light-text-accent);
}

.dark .api-namespace-toggle-text {
  color: #0ea5e9;
  opacity: 0.8;
}

.dark .api-namespace-toggle:hover .api-namespace-toggle-text {
  opacity: 1;
  color: #3ca5e9;
}

/* When hovering over collapsed area in dark mode */
.dark .api-namespace-toggle[aria-expanded="false"] + .api-namespace-content.has-overflow:hover ~ .api-namespace-toggle .api-namespace-toggle-text,
.dark .api-index__entry:has(.api-namespace-content.has-overflow:hover) .api-namespace-toggle-text {
  opacity: 1;
  color: #3ca5e9;
}

.dark .api-namespace-icon {
  color: #0ea5e9;
  opacity: 0.8;
}

.dark .api-namespace-toggle:hover .api-namespace-icon {
  opacity: 1;
  color: #3ca5e9;
}

/* When hovering over collapsed area in dark mode */
.dark .api-index__entry:has(.api-namespace-content.has-overflow:hover) .api-namespace-icon {
  opacity: 1;
  color: #3ca5e9;
}

.dark .api-namespace-toggle[aria-expanded="false"] + .api-namespace-content::after {
  background: linear-gradient(to bottom, 
    transparent 0%, 
    var(--color-dark-bg) 100%);
}

.dark .api-namespace-toggle[aria-expanded="false"] + .api-namespace-content.has-overflow {
  background: linear-gradient(to bottom,
    rgba(255, 255, 255, 0.02) 0%,
    rgba(255, 255, 255, 0.04) 50%,
    rgba(255, 255, 255, 0.05) 100%);
}

.dark .api-namespace-toggle[aria-expanded="false"] + .api-namespace-content.has-overflow::before {
  background: var(--color-light-text-accent);
  color: var(--color-dark-bg);
  box-shadow: var(--shadow-dark-lg);
}

.dark .api-index__entry > ul a {
  background: var(--color-dark-surface);
  color: var(--color-dark-text-secondary);
  border-color: var(--color-dark-border);
  box-shadow: var(--shadow-dark-sm);
}

.dark .api-index__entry > ul a:hover {
  background: var(--color-light-text-accent);
  color: var(--color-dark-bg);
  border-color: var(--color-light-text-accent);
  box-shadow: var(--shadow-dark-md);
}

.dark .page-toc a {
  color: var(--color-dark-text-secondary);
}

.dark .page-toc a:hover {
  color: var(--color-light-text-accent);
  background: var(--color-dark-surface-hover);
}

.dark .page-toc a.active {
  color: var(--color-light-text-accent);
  background: var(--color-dark-surface-hover);
}

/* Dark cards and navigation */
.dark .related-container {
  background: transparent;
  border: none;
  box-shadow: none;
}

.dark .related-container .link {
  background: var(--color-dark-surface);
  border-color: var(--color-dark-border);
  color: var(--color-light-text-accent);
}

.dark .related-container .link:hover {
  border-color: var(--color-light-text-accent);
  background: var(--color-dark-surface-hover);
}

.dark .related-container .link .link-title {
  color: var(--color-light-text-accent);
}

.dark .related-container .link > span:not(.link-title) {
  color: var(--color-light-text-accent);
}

/* Dark card */
.dark .card {
  background: var(--color-dark-surface);
  border-color: var(--color-dark-border);
  box-shadow: var(--shadow-dark-sm);
}

.dark .card:hover {
  box-shadow: var(--shadow-dark-lg);
  border-color: var(--color-light-text-accent);
}

/* Dark badges */
.dark .badge-primary {
  background: rgba(56, 189, 248, 0.2);
  color: var(--color-light-text-accent);
}

.dark .badge-success {
  background: var(--color-dark-current-badge-bg);
  color: var(--color-dark-current-badge-text);
}

.dark .badge-warning {
  background: rgba(245, 158, 11, 0.2);
  color: #fbbf24;
}

.dark .badge-error {
  background: rgba(239, 68, 68, 0.2);
  color: #f87171;
}

/* Dark buttons */
.dark .btn-primary {
  background: var(--color-light-text-accent);
  color: var(--color-dark-bg);
  box-shadow: var(--shadow-dark-sm);
}

.dark .btn-primary:hover {
  background: var(--color-light-text-accent);
  box-shadow: var(--shadow-dark-md);
}

.dark .btn-secondary {
  background: var(--color-dark-surface);
  color: var(--color-light-text-accent);
  border-color: var(--color-light-text-accent);
}

.dark .btn-secondary:hover {
  background: rgba(56, 189, 248, 0.15);
}

/* Dark back to top button */
.dark .back-to-top-button,
.dark #back-to-top-button {
  background: var(--color-dark-surface);
  color: var(--color-dark-text-primary);
  border: 1px solid var(--color-dark-border);
  box-shadow: var(--shadow-dark-lg);
}

.dark .back-to-top-button:hover,
.dark #back-to-top-button:hover {
  background: var(--color-light-text-accent);
  color: var(--color-dark-bg);
  box-shadow: var(--shadow-dark-xl);
  border-color: var(--color-light-text-accent);
}

/* Dark search results */
.dark .search-results {
  background: var(--color-dark-surface);
  border-color: var(--color-dark-border);
  box-shadow: var(--shadow-dark-lg);
  color: var(--color-dark-text-primary);
}

.dark .search-results__item {
  border-bottom-color: var(--color-dark-border);
}

.dark .search-result-link {
  color: var(--color-dark-text-primary);
}

.dark .search-results__item:hover {
  background: var(--color-dark-surface-hover);
}

.dark .result-type-badge--api {
  background: rgba(99, 102, 241, 0.3);
  color: #b0b3ff;
  border: 1px solid rgba(99, 102, 241, 0.5);
}

.dark .result-type-badge--docs {
  background: rgba(14, 165, 233, 0.3);
  color: #7dd3fc;
  border: 1px solid rgba(14, 165, 233, 0.5);
}

.dark .search-results__item .fn-name {
  color: var(--color-light-text-accent);
}

.dark .search-results__item .fn-signature {
  color: var(--color-light-text-accent);
}

.dark .search-results__item strong {
  color: var(--color-light-text-accent);
}

.dark .search-results__item .title {
  color: var(--color-dark-text-primary);
}

.dark .search-results__item .desc {
  color: var(--color-dark-text-primary);
}

.dark .search-results__item mark {
  background: rgba(56, 189, 248, 0.3);
  color: var(--color-light-text-accent);
}

/* Dark footer */
.dark .site-footer {
  background: var(--color-dark-bg-secondary);
  border-top-color: var(--color-dark-border);
}

.dark .footer-logo .phel-logo {
  stroke: white;
}

.dark .footer-logo .logo-text {
  color: var(--color-dark-text-primary);
}

.dark .footer-description {
  color: var(--color-dark-text-secondary);
}

.dark .footer-social a {
  background: var(--color-dark-surface);
  border-color: var(--color-dark-border);
  color: var(--color-dark-text-primary);
}

.dark .footer-social a:hover {
  background: var(--color-light-text-accent);
  border-color: var(--color-light-text-accent);
  color: var(--color-dark-bg);
}

.dark .footer-column h3 {
  color: var(--color-dark-text-primary);
}

.dark .footer-column ul li a {
  color: var(--color-dark-text-secondary);
}

.dark .footer-column ul li a:hover {
  color: var(--color-light-text-accent);
}

.dark .footer-bottom {
  border-top-color: var(--color-dark-border);
}

.dark .footer-copyright {
  color: var(--color-dark-text-secondary);
}

.dark .footer-badge {
  color: var(--color-dark-text-secondary);
}

.dark .footer-badge-separator {
  color: var(--color-dark-text-muted);
}

.dark .footer-badge-version {
  background: var(--color-light-text-accent);
  color: var(--color-dark-bg);
}

/* Dark focus states */
.dark a:focus-visible,
.dark button:focus-visible {
  outline-color: var(--color-light-text-accent);
}

/* Dark selection */
.dark ::selection {
  background: rgba(56, 189, 248, 0.3);
}

.dark ::-moz-selection {
  background: rgba(56, 189, 248, 0.3);
}
